<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Logging Test</title>

    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="postmessage/postmessage.js"></script>
    <script type="text/javascript" src="logging.js"></script>

    <link rel="stylesheet" type="text/css" href="logWindow.css"/>
</head>
<body>

<form name="writeLog" action="#" onsubmit="noSubmit()">
    <input type="button" id="levelButton" value="Level"/>
    <label for="areaText">Area:</label>
    <input type="text" id="areaText" value="Ohio"/>
    <label for="levelSelct">Level:</label>
    <select id="levelSelct"> </select>
    <label for="messageText">Message:</label>
    <input type="text" id="messageText" value="Read Me!"/>
    <input type="button" id="logButton" value="Log"/>
    <span id='handlers'></span>
</form>

<script type="text/javascript">
    function noSubmit() {
        return false;
    }

    function createHandlerOptions() {
        var inUse = log.areaDefaults().handlers;
        for (var handlerName in log.handlers) {
            var handler = log.handlers[handlerName];
            var checkbox = $('<input type="checkbox"/>');
            var id = handlerName + 'Opt';
            checkbox.attr('id', id);
            checkbox.attr('name', handlerName);
            checkbox.attr('checked', inUse.indexOf(handler) >= 0);
            checkbox.change(handlerCheckboxChanged);
            var label = $('<label/>').attr('for', id).text(handlerName);
            $('#handlers').append(checkbox).append(label);
        }
    }

    function handlerCheckboxChanged(evt) {
        var checkbox = $(evt.target);
        var name = checkbox.attr('name');
        var handler = log.handlers[name];
        var inUse = log.areaDefaults().handlers;
        var pos = inUse.indexOf(handler);
        if (checkbox.attr('checked')) {
            if (pos < 0) {
                inUse.push(handler);
            }
        } else {
            if (pos >= 0) {
                inUse.splice(pos, 1);
            }
        }
        log.areaDefaults({handlers: inUse});
    }

    function createLevelSelect() {
        var levelSelct = $('#levelSelct');
        var defaults = log.areaDefaults();
        for (var levelName in log.levels) {
            var opt = $('<option>' + levelName + '</option>');
            if (levelName == defaults.level) {
                opt.attr('selected', 'selected');
            }
            levelSelct.append(opt);
        }
    }

    function logLevel() {
        return $('#levelSelct :selected').val();
    }

    function doLog() {
        log.log($('#areaText').val(), logLevel(), $('#messageText').val());
    }

    function doLevel() {
        log.area($('#areaText').val(), {level: logLevel()});
    }

    $(document).ready(function() {
        createHandlerOptions();
        createLevelSelect();
        $('#logButton').click(doLog);
        $('#levelButton').click(doLevel);
    });
</script>
</body>
</html>